# 质量门禁规范

本文档定义内容生成的质量标准和检查流程。

## 质量门禁概览

```
质量门禁0（历史检查）
├── 已读取最近选题历史
├── 已检查连载系列状态
└── 今日选题无高度重复

质量门禁1（选题质量）
├── 每个板块都有1个选题
├── 选题符合板块定位
└── 优先级评分≥25分

质量门禁2（内容质量）
├── 字数在规定范围内
├── 风格符合要求
└── 结构完整

质量门禁3（配图完整性）
├── 每篇文章至少1张图片
├── 所有图片已下载到本地
└── 图片文件正常

质量门禁4（发布合规性）
├── YAML Front Matter 完整
├── 图片路径正确且可读
└── 占位符已全部替换
```

## 质量门禁详细说明

### 质量门禁0：历史检查

**目的**：避免选题重复和系列中断

**检查项**：
1. 已读取最近选题历史（15天）
2. 已检查连载系列状态（如有）
3. 今日选题无高度重复

**不通过处理**：
- 调整选题角度
- 或选择其他候选选题

### 质量门禁1：选题质量

**目的**：确保选题符合板块定位且质量合格

**检查项**：
1. 每个板块都有1个选题
2. 选题符合板块定位
3. 优先级评分≥25分（满分40分）
4. 有明确的新闻来源URL（如果适用）

**评分维度**：
- 时效性（25%权重）
- 争议性（25%权重）
- 实用性（25%权重）
- 情感性（25%权重）

**不通过处理**：
- 返回重新检索
- 或调整选题标准

### 质量门禁2：内容质量

**目的**：确保生成的内容符合质量标准

**检查项**：
1. **结构检查**
   - 所有必选模块都存在
   - 可选模块合理选取
   - 标题格式正确

2. **字数检查**
   - 字数在规定范围内（±10%）
   - 统计规则符合配置

3. **风格检查**
   - Emoji使用符合标准
   - 口语化表达符合标准
   - 没有禁止使用的表达
   - 风格统一，符合账号定位

4. **事实准确性检查**
   - 所有关键数据都有来源标注
   - 关键数据已交叉验证
   - 没有未经证实的断言
   - 无法验证的数据使用了限定词

**不通过处理**：
- 根据问题类型调整内容
- 重新执行质量检查
- 最多重试3次

### 质量门禁3：配图完整性

**目的**：确保配图符合要求且可用

**检查项**：
1. **图片数量**：每篇文章至少1张图片
2. **本地下载**：所有图片已生成并下载到本地
3. **文件正常**：图片文件正常（>100KB且<2MB）
4. **路径正确**：图片引用使用本地相对路径（`./images/{文件名}`）
5. **清单文件**：`images/manifest.txt` 存在且完整
6. **来源标注**：图片有明确的来源标注（AI生成/网络平台）
7. **记录完整**：图片生成/下载记录完整
8. **内容相关**：图片内容符合主题要求

**manifest.txt检查**：
- 文件存在于 `images/` 目录
- 包含所有图片的记录
- 每张图片记录：文件名、来源、时间、用途
- 网络图片包含原URL记录

**图片来源标注检查**：
- AI生成图片：标注 `*图片来源: AI生成*`
- 网络下载图片：标注 `*图片来源: XX平台*`
- 本地拍摄图片：标注 `*图片来源: 本地拍摄*`

**不通过处理**：
- 继续生成或重新生成
- 补充缺失的manifest.txt
- 修正图片来源标注
- 直到全部通过

### 质量门禁4：发布合规性

**目的**：确保内容在发布到平台前符合技术和视觉要求

**检查项**：
1. **Front Matter 检查**：
   - `title` 必须存在且非空
   - `cover` 必须存在且为本地封面图路径
2. **路径合规性**：
   - 文章内容中图片引用保持相对路径（`./images/{文件名}`）
   - 发布前生成发布版本文件（publish-ready），将图片引用（含 `cover`）转换为本地绝对路径（发布工具解析更稳定）
   - **检查**：确认 publish-ready 文件中引用的本地绝对路径真实存在
3. **内容清洁度**：
   - 无 `[在此处插入...]` 等占位符
   - 无 AI 自我介绍或提示词引导语（如 "Sure, here is...")
4. **发布策略对齐**：
   - 检查文章主题（Theme）是否符合板块定义的默认推荐

**不通过处理**：
- 自动修复明显的路径错误
- 补全缺失的元数据
- 提示用户进行必要的人工修正

## 质量检查流程

### 自动检查

Skill 会自动执行上述所有质量门禁，并在 `current-run-status.md` 中记录结果。

### 人工检查

建议在自动检查通过后，人工快速抽查：
- 浏览生成的文章
- 检查图片是否正常显示
- 确认风格是否符合预期

## 质量标准配置

质量标准可以在账号配置文件中自定义：

- **writing-style.md**：定义字数标准、风格要求
- **content-structure.md**：定义结构要求
- **account-config.md**：启用/禁用质量检查模块

## 质量问题处理

### 常见问题

1. **字数超出范围**
   - 删除冗余论述
   - 精简案例（保留核心）
   - 删除可选模块（如果有）

2. **风格不符合要求**
   - 增加emoji（如果要求）
   - 替换媒体用语
   - 增加口语化表达

3. **数据无法验证**
   - 使用限定词："据媒体报道"、"预计"
   - 禁止直接陈述未经证实的数据

4. **图片不符合预期**
   - 优化Prompt
   - 简化Prompt
   - 重新生成（最多3次）
