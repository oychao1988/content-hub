# 侧边栏分组菜单重构计划

## 任务概述
将当前平铺式的 12 个菜单项重构为基于角色的分组折叠菜单结构，提升菜单的可读性和可维护性。

**当前问题**:
- 所有菜单平铺展示，无分组结构
- 业务功能和系统管理功能混杂
- 管理员看到 12 个菜单项，过于冗长

**目标结构**:
```
📊 仪表盘

📝 内容运营 [operator/editor/viewer可见]
  ├─ 账号管理 [operator]
  ├─ 内容管理 [operator/editor]
  ├─ 发布管理 [operator]
  └─ 发布池 [operator]

⏰ 任务调度 [operator可见]
  └─ 定时任务

⚙️ 系统管理 [admin可见]
  ├─ 用户管理
  ├─ 客户管理
  ├─ 平台管理
  ├─ 写作风格管理
  ├─ 内容主题管理
  └─ 系统配置
```

---

## 阶段划分

### 阶段 1: 分析现有代码和权限系统 [✓ 已完成]
- **目标**: 深入理解现有菜单渲染逻辑和权限检查机制
- **详细描述**:
  - 分析 MainLayout.vue 中的 menuRoutes 计算属性
  - 理解当前路由配置的权限定义
  - 确认各角色对应的权限集合
  - 确定需要哪些图标
- **完成标准**:
  - 文档化当前的菜单渲染机制 ✓
  - 列出所有角色及其可见的菜单项 ✓
  - 确定需要的图标列表 ✓
- **执行结果**:
  - **当前机制**: MainLayout 通过 `router.getRoutes()` 动态获取路由，过滤后渲染为平铺菜单
  - **权限检查**: 双重机制（角色 + 权限）
  - **角色菜单映射**:
    - admin: 12个菜单（全部）
    - operator: 7个菜单（仪表盘+账号+内容+发布+定时任务+发布池）
    - customer: 6个菜单（只读权限）
    - editor: 2个菜单（仪表盘+内容管理）
    - viewer: 2个菜单（仪表盘+内容管理只读）
  - **图标问题**: `Platform` 图标在 Element Plus 中不存在，需要替换为 `Monitor` 或 `Grid`
  - **冗余代码**: 模板中有重复的权限检查 `v-if="!route.meta?.role || userStore.isAdmin"`
- **状态**: ✓ 已完成

### 阶段 2: 设计菜单配置结构 [✓ 已完成]
- **目标**: 创建清晰的菜单分组配置数据结构
- **详细描述**:
  - 设计菜单配置的 JSON 结构
  - 定义分组（submenu）和菜单项（menu item）
  - 配置每个分组/菜单项的：
    - 显示标题
    - 图标
    - 路由路径
    - 权限要求（permissions）
    - 角色要求（role）
- **完成标准**:
  - 创建独立的菜单配置文件 `src/router/menu.config.js` ✓
  - 包含完整的分组菜单定义 ✓
  - 每个菜单项都有清晰的权限控制 ✓
- **执行结果**:
  - **创建文件**: `/Users/Oychao/Documents/Projects/content-hub/src/frontend/src/router/menu.config.js`
  - **数据结构**: 三层结构（顶级菜单、分组菜单、子菜单项）
  - **权限控制**: 支持 permissions、role、visibleRoles 三种方式
  - **图标修复**: 平台管理使用 `Monitor` 替代不存在的 `Platform`
  - **菜单分组**: 仪表盘（独立）+ 内容运营（4项）+ 任务调度（1项）+ 系统管理（6项）
- **状态**: ✓ 已完成

### 阶段 3: 修改 MainLayout.vue 组件 [✓ 已完成]
- **目标**: 更新侧边栏组件以支持分组菜单
- **详细描述**:
  - 将 `el-menu-item` 改为 `el-sub-menu` 分组结构
  - 实现分组菜单的权限过滤逻辑
  - 保持现有的折叠/展开功能
  - 更新图标引用（使用 Element Plus 图标）
- **完成标准**:
  - MainLayout.vue 能够正确渲染分组菜单 ✓
  - 权限过滤正常工作 ✓
  - 折叠/展开功能正常 ✓
  - 代码风格与现有代码一致 ✓
- **执行结果**:
  - **修改文件**: MainLayout.vue + menu.config.js（图标修正）
  - **新增功能**:
    - `checkMenuPermission()` 权限检查函数
    - `filteredMenus` 计算属性（替代原 menuRoutes）
    - 分组菜单渲染逻辑（el-sub-menu）
  - **权限逻辑**: 支持 role、permissions、visibleRoles 三种方式
  - **图标修复**: Dashboard → DataBoard（Element Plus 兼容）
  - **构建验证**: ✓ 成功构建，无错误
- **状态**: ✓ 已完成

### 阶段 4: 清理路由配置 [✓ 已完成 - 合并到阶段 3]
- **目标**: 移除路由配置中的菜单相关元数据
- **详细描述**:
  - 将菜单配置从 router/index.js 迁移到 menu.config.js
  - 保留路由配置中的权限元数据（用于路由守卫）
  - 移除路由配置中的 icon 和 title（这些现在由菜单配置管理）
- **完成标准**:
  - router/index.js 只包含路由定义和权限元数据
  - 菜单显示逻辑完全由 menu.config.js 控制
  - 路由守卫仍然正常工作
- **执行结果**: 菜单配置已完全迁移到 menu.config.js，路由守卫保持正常工作
- **状态**: ✓ 已完成（阶段 3 中一并完成）

### 阶段 5: 添加 Element Plus 图标导入 [✓ 已完成 - 合并到阶段 3]
- **目标**: 确保所有需要的图标都已正确导入
- **详细描述**:
  - 在 MainLayout.vue 中导入所有需要的图标
  - 验证图标名称与 Element Plus 图标组件匹配
  - 添加缺失的图标
- **完成标准**:
  - 所有菜单分组和菜单项都有对应的图标
  - 图标正确显示在侧边栏中
- **执行结果**: 所有图标已正确导入，Dashboard 改为 DataBoard
- **状态**: ✓ 已完成（阶段 3 中一并完成）

### 阶段 6: 测试不同角色的菜单显示 [✓ 已完成]
- **目标**: 验证各角色看到正确的菜单结构
- **详细描述**:
  - 测试 admin 角色（应看到所有分组）
  - 测试 operator 角色（应看到仪表盘、内容运营、任务调度）
  - 测试 editor 角色（应看到仪表盘、内容运营-仅内容管理）
  - 测试 customer 角色（应看到仪表盘、只读菜单）
  - 测试 viewer 角色（应看到仪表盘、内容运营-仅内容管理）
- **完成标准**:
  - 每个角色看到正确的菜单项 ✓
  - 无权限的菜单项被正确隐藏 ✓
  - 分组在无子菜单时自动隐藏 ✓
- **执行结果**:
  - **Admin**: ✓ 12个菜单（全部）
  - **Operator**: ✓ 6个菜单（仪表盘+内容运营4项+定时任务）
  - **Editor**: ✓ 2个菜单（仪表盘+内容管理）
  - **Customer**: ✓ 3个菜单（仪表盘+账号+发布管理）
  - **Viewer**: ✓ 2个菜单（仪表盘+内容管理）
  - **发现并修复问题**: Viewer 角色无法看到内容管理（已修复 visibleRoles）
  - **权限过滤逻辑**: ✓ 正确
  - **分组自动隐藏**: ✓ 正常工作
- **状态**: ✓ 已完成

### 阶段 7: 生成总结报告 [✓ 已完成]
- **目标**: 文档化所有修改和使用说明
- **详细描述**:
  - 创建 SUMMARY.md 文档
  - 记录所有修改的文件
  - 提供菜单配置示例
  - 说明如何添加新的菜单项
- **完成标准**:
  - 完整的修改总结报告 ✓
  - 清晰的使用文档 ✓
  - 未来扩展指南 ✓
- **执行结果**:
  - **创建文档**: `/Users/Oychao/Documents/Projects/content-hub/SIDEBAR_MENU_REFACTOR-SUMMARY.md`
  - **文档内容**:
    - 项目概述（重构目标、菜单结构）
    - 修改的文件（新建 menu.config.js、修改 MainLayout.vue）
    - 技术实现（菜单配置、权限过滤、分组渲染）
    - 各角色菜单对照（5 个角色 × 11 个菜单项）
    - 使用指南（添加菜单、修改权限）
    - 注意事项（权限优先级、常见问题）
    - 测试验证（各角色结果、已修复问题）
  - **文档规模**: 约 8000+ 字、15+ 代码示例、8 个表格
- **状态**: ✓ 已完成

---

## 整体进展
- 已完成: 7 / 7 ✅ 全部完成！
- 项目状态: 已成功完成侧边栏分组菜单重构

---

## 重要备注

### 用户角色对照（5种）
| 角色 | 说明 | 菜单可见性 |
|------|------|------------|
| admin | 管理员 | 所有菜单 |
| operator | 运营人员 | 仪表盘 + 内容运营 + 任务调度 |
| customer | 客户 | 仪表盘 + 只读菜单 |
| editor | 编辑 | 仪表盘 + 内容管理 |
| viewer | 查看者 | 仪表盘 + 内容管理（只读） |

### 需要的 Element Plus 图标
- Dashboard（仪表盘）
- Document（内容运营）
- User（账号管理）
- Promotion（发布管理）
- Box（发布池）
- Timer（任务调度）
- Setting（系统管理）
- UserFilled（用户管理）
- OfficeBuilding（客户管理）
- Platform（平台管理）
- EditPen（写作风格管理）
- CollectionTag（内容主题管理）
